{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="{% static './rewrite/style.css' %}" />
  </head>
  <body>
    <div class="post-box">
      <div class="header">
        <img
          src="{% static './rewrite/profile.png'%}"
          alt="Profile Picture"
          class="profile-pic"
        />
        <span class="name">LinkedIn Rewrite</span>
        <span class="privacy">Post to Anyone</span>
      </div>
      <div class="input-area">
        <textarea
          placeholder="What do you want to talk about?"
          id="postInput"
          name="postInput"
        ></textarea>
        <div class="actions">
          <div class="actionButton">
          <div class="checkbox-con">
            <input id="emojiNeeded" type="checkbox" />ðŸ˜€
          </div>
          <!-- <button id="emoji-btn">ðŸ˜€</button> -->
          
        </div>
        <div class="actionButton">
          <button
            id="robot-btn"
            onclick="window.open('https://github.com/zpratikpathak')"
          >
            &#128420;
          </button>
          <button id="add-btn">#</button>
          <!-- <button id="post-btn" disabled>Post</button> -->
          <button id="doc-btn" onclick="copyText()">
            Copy&nbsp;
            <span class="svgIcon"></span>
            <svg
              fill="black"
              viewBox="0 0 384 512"
              height="1em"
              xmlns="http://www.w3.org/2000/svg"
            >
              
                <path
                  d="M280 64h40c35.3 0 64 28.7 64 64V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128C0 92.7 28.7 64 64 64h40 9.6C121 27.5 153.3 0 192 0s71 27.5 78.4 64H280zM64 112c-8.8 0-16 7.2-16 16V448c0 8.8 7.2 16 16 16H320c8.8 0 16-7.2 16-16V128c0-8.8-7.2-16-16-16H304v24c0 13.3-10.7 24-24 24H192 104c-13.3 0-24-10.7-24-24V112H64zm128-8a24 24 0 1 0 0-48 24 24 0 1 0 0 48z"
                ></path>
              </span>
            </svg>
          </button>
          <button id="rewrite-btn" type="submit">Rewrite with AIâœ¨</button>
        </div>
        </div>
      </div>
    </div>
  </body>

  <script>
    function sendData() {
      var postInput = document.getElementById("postInput").value;
      var emojiNeeded = document.getElementById("emojiNeeded").checked;

      const data = {
        postInput: postInput,
        emojiNeeded: emojiNeeded,
      };

      fetch("{% url 'rewrite' %}", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": "{{ csrf_token }}", // Include the CSRF token for security
        },
        body: JSON.stringify(data),
      })
        .then((response) => response.json())
        .then((data) => {
          console.log("Success:", data.success);
          console.log("Message:", data.rewriteAI);
          console.log("data:", data);
          // Handle the response from the server
          const responseAI = data.rewriteAI;
          const postInput = document.getElementById("postInput");
          let i = 0;
          const typingEffect = setInterval(() => {
            postInput.value = responseAI.slice(0, i);
            postInput.rows = postInput.value.split("\n").length; // Adjust the rows attribute based on the number of lines in the textarea
            i++;
            if (i > responseAI.length) {
              clearInterval(typingEffect);
            }
          }, 30);

          // Handle the response from the server
        })
        .catch((error) => console.error(error));
    }

    // Trigger the sendData function when needed
    // For example, you can call it on a button click
    const rewriteBtn = document.getElementById("rewrite-btn");
    rewriteBtn.addEventListener("click", sendData);
  </script>
  <script src="{% static './rewrite/script.js'%}"></script>
</html>
