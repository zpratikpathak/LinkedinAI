{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="{% static './rewrite/style.css' %}" />
  </head>
  <body>
    <div class="post-box">
      <div class="header">
        <img
          src="{% static './rewrite/profile.png'%}"
          alt="Profile Picture"
          class="profile-pic"
        />
        <span class="name">LinkedIn Rewrite</span>
        <span class="privacy">Post to Anyone</span>
      </div>
      <div class="input-area">
        <textarea
          placeholder="What do you want to talk about?"
          id="postInput"
          name="postInput"
        ></textarea>
        <div class="actions">
          <div class="checkbox-con">
            <input id="emojiNeeded" type="checkbox" />ðŸ˜€
          </div>
          <!-- <button id="emoji-btn">ðŸ˜€</button> -->
          <button id="doc-btn" onclick="copyText()">ðŸ“„</button>
          <button
            id="robot-btn"
            onclick="window.open('https://github.com/zpratikpathak')"
          >
            &#128420;
          </button>
          <button id="add-btn">+</button>
          <!-- <button id="post-btn" disabled>Post</button> -->
          <button id="rewrite-btn" type="submit">Rewrite with AIâœ¨</button>
        </div>
      </div>
    </div>
  </body>

  <script>
    function sendData() {
      var postInput = document.getElementById("postInput").value;
      var emojiNeeded = document.getElementById("emojiNeeded").checked;

      const data = {
        postInput: postInput,
        emojiNeeded: emojiNeeded,
      };

      fetch("{% url 'rewrite' %}", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": "{{ csrf_token }}", // Include the CSRF token for security
        },
        body: JSON.stringify(data),
      })
        .then((response) => response.json())
        .then((data) => {
          console.log("Success:", data.success);
          console.log("Message:", data.rewriteAI);
          console.log("data:", data);
          // Handle the response from the server
          const responseAI = data.rewriteAI;
          const postInput = document.getElementById("postInput");
          let i = 0;
          const typingEffect = setInterval(() => {
            postInput.value = responseAI.slice(0, i);
            i++;
            if (i > responseAI.length) {
              clearInterval(typingEffect);
            }
          }, 30);

          // Handle the response from the server
        })
        .catch((error) => console.error(error));
    }

    // Trigger the sendData function when needed
    // For example, you can call it on a button click
    const rewriteBtn = document.getElementById("rewrite-btn");
    rewriteBtn.addEventListener("click", sendData);
  </script>
  <script src="{% static './rewrite/script.js'%}"></script>
</html>
